# LaTeX 数学公式规范

## 基本原则

**最重要的规则**：所有数学符号和变量**必须**包裹在数学模式中（`$...$` 或 `$$...$$`）

禁止在文本中直接使用数学符号（如 `x`, `y`, `w`, `b`, `∈`, `×`, `→` 等）

确保公式在 Markdown 编辑器和 MathJax 中都能正确渲染

## 数学模式使用

### 行内公式
使用：`$公式$`（在段落中使用）

示例：
```
变量 $x$ 的值是 5
函数 $f(x) = x^2$
```

### 独立公式
使用：`$$公式$$`（单独一行，居中显示）

示例：
```
$$
f(x) = \int_0^1 x^2 dx
$$
```

### 所有数学变量必须包裹
✅ 正确：`$x$`, `$y$`, `$w_i$`, `$b$`
❌ 错误：`x`, `y`, `w_i`, `b`（未包裹）

## 必须遵守的 LaTeX 规范

### 1. 变量和标量
- ✅ 正确：`$x$`, `$y$`, `$w_i$`, `$b$`
- ❌ 错误：`x`, `y`, `w_i`, `b`（未包裹）

### 2. 向量
- ✅ 正确：`$\mathbf{x}$`, `$\mathbf{w}$`, `$\vec{v}$`
- ❌ 错误：`x`, `w`, `v`（未包裹，未标记为向量）

### 3. 上标和下标
- ✅ 正确：`$x^{(1)}$`, `$w_{ij}$`, `$\sigma'$`, `$f_t$`
- ⚠️ 可以：`$x^2$`, `$W^T$`（单个字符可以不用花括号）
- ❌ 错误：`$x^(1)$`, `$w_ij$`, `f_t`（括号格式错误或未包裹）

**重要**：上标必须使用 `^{...}` 而非 `^(...)`，下标必须使用 `_{...}` 而非 `_(...)`

### 4. 希腊字母
- ✅ 正确：`$\alpha$`, `$\beta$`, `$\sigma$`, `$\delta$`, `$\theta$`
- ❌ 错误：`α`, `β`, `σ`, `δ`, `θ`（直接使用 Unicode）

**常见希腊字母**：
```
\alpha, \beta, \gamma, \delta, \epsilon, \theta, \lambda, \mu, \pi, \sigma, \tau, \phi, \omega
\Delta, \Sigma, \Phi, \Psi, \Omega
```

### 5. 特殊符号
- ✅ 正确：`$\times$`（乘法）, `$\to$`（箭头）, `$\in$`（属于）
- ✅ 正确：`$\mathbb{R}$`（实数集）, `$\subset$`（子集）, `$\neq$`（不等）
- ❌ 错误：`×`, `→`, `∈`, `R`（直接使用 Unicode 或未包裹）

**常见特殊符号**：
```
\times, \to, \in, \subset, \approx, \equiv, \neq, \leq, \geq
\infty, \partial, \nabla, \cdot
\mathbb{R}, \mathbb{N}, \mathbb{Z}, \mathbb{C}
```

### 6. 分数和导数
- ✅ 正确：`$\frac{\partial f}{\partial x}$`, `$\frac{a}{b}$`
- ✅ 正确：`$f'(x)$`, `$\frac{dy}{dx}$`
- ❌ 错误：`∂f/∂x`, `dy/dx`（未包裹）

### 7. 集合和区间
- ✅ 正确：`$\{1, 2, 3\}$`, `$[0, 1]$`, `$\mathbb{R}^d$`
- ❌ 错误：`{1, 2, 3}`, `[0, 1]`, `R^d`（未包裹或花括号未转义）

**注意**：在 Markdown 中，花括号需要转义为 `\{` 和 `\}`

### 8. 矩阵
- ✅ 正确：`$\begin{pmatrix} a & b \\ c & d \end{pmatrix}$`
- ✅ 正确：`$\begin{bmatrix} 1 & 0 \\ 0 & 1 \end{bmatrix}$`

### 9. 积分和求和
- ✅ 正确：`$\int_a^b f(x) dx$`, `$\sum_{i=1}^{n} x_i$`
- ❌ 错误：`∫`, `Σ`（直接使用 Unicode）

### 10. 表格中的数学
- ✅ 正确：`| $x_1$ | $x_2$ | $x_1 + x_2$ |`
- ❌ 错误：`| x_1 | x_2 | x_1 + x_2 |`（变量未包裹）

## 常见错误示例及修复

| 错误写法 | 正确写法 | 原因 |
|---------|---------|------|
| `x = (x_1, x_2, ..., x_d)^T` | `$\mathbf{x} = (x_1, x_2, \ldots, x_d)^T$` | 未包裹，省略号格式错误 |
| `权重 w_i` | `权重 $w_i$` | 变量未包裹 |
| `训练样本 (x_i, y_i)` | `训练样本 $(\mathbf{x}_i, y_i)$` | 未包裹 |
| `y ∈ {−1, +1}` | `$y \in \{-1, +1\}$` | 未包裹，花括号未转义 |
| `输入 → 隐藏层 → 输出层` | `输入 $\to$ 隐藏层 $\to$ 输出层` | 箭头未包裹 |
| `W ∈ R^(m×n)` | `$W \in \mathbb{R}^{m \times n}$` | 未包裹，符号格式错误 |
| `32×32 图像` | `$32 \times 32$ 图像` | 乘号未包裹 |
| `α_{ij} = 0.5` | `$\alpha_{ij} = 0.5$` | 希腊字母未包裹 |
| `f_t 接近 1` | `$f_t$ 接近 1` | 下标变量未包裹 |
| `1-NN 算法` | `1{-}NN 算法` 或 `1NN 算法` | 连字符在下标中导致歧义 |

## 最佳实践

### 1. 编写公式时的检查清单
- [ ] 所有数学变量是否都用 `$...$` 或 `$$...$$` 包裹？
- [ ] 上标是否用 `^{...}` 而非 `^(...)`？
- [ ] 下标是否用 `_{...}` 而非 `_(...)`？
- [ ] 希腊字母是否用 LaTeX 命令（如 `\alpha`）而非 Unicode？
- [ ] 特殊符号（×, →, ∈ 等）是否用 LaTeX 命令？
- [ ] 花括号在文本中是否转义为 `\{` 和 `\}`？
- [ ] 向量是否用 `\mathbf{}` 或 `\vec{}` 标记？

### 2. 常用模板
```
函数定义：$f: \mathbb{R}^n \to \mathbb{R}^m$
向量：$\mathbf{x} = (x_1, x_2, \ldots, x_n)^T$
矩阵维度：$W \in \mathbb{R}^{m \times n}$
求和：$\sum_{i=1}^{n} x_i$
梯度：$\nabla f(\mathbf{x})$
偏导数：$\frac{\partial f}{\partial x_i}$
激活函数：$\sigma(z) = \frac{1}{1 + e^{-z}}$
Softmax：$\text{softmax}(z)_i = \frac{e^{z_i}}{\sum_{j=1}^{c} e^{z_j}}$
```

### 3. 测试验证
- 在支持 MathJax 的 Markdown 编辑器中预览
- 检查浏览器控制台是否有 MathJax 错误
- 确保所有公式正确渲染，没有显示为源代码

## MathJax 解析失败的常见原因

### 症状：浏览器控制台有 MathJax 错误

**常见原因**：
1. 未闭合的 `$` 或 `$$`
2. 在数学模式中使用了未转义的特殊字符（如 `#`, `%`, `&`）
3. 上标/下标格式错误（`^(...)` 应为 `^{...}`）
4. 连字符在下标中导致歧义（`1-NN` 应为 `1{-}NN` 或 `1NN`）

**解决**：使用 `hugo --quiet` 测试，检查构建输出

## 特殊场景

### 连字符在下标中
当在下标中使用连字符时，MathJax 可能会误解析。

- ❌ 错误：`$x_{1-NN}$`
- ✅ 正确：`$x_{1{-}NN}$` 或 `$x_{1NN}$`

### 表达式中的文本
在数学模式中包含文本时，使用 `\text{}` 命令：

- ✅ 正确：`$\text{对于所有 } x \in \mathbb{R}$`
- ❌ 错误：`对于所有 $x \in \mathbb{R}$`（中英文混排）

### 多行公式推导
使用 `align` 环境对齐多行公式：

```latex
$$
\begin{align}
E &= mc^2 \\
  &= \sqrt{p^2c^2 + m^2c^4}
\end{align}
$$
```

## 调试技巧

### 1. 逐步检查
从简单的公式开始，逐步增加复杂度：

```
测试1：$x$ （单个变量）
测试2：$x^2$ （上标）
测试3：$\alpha$ （希腊字母）
测试4：$\frac{a}{b}$ （分数）
```

### 2. 浏览器控制台
打开浏览器开发者工具，查看 Console 中的 MathJax 错误信息

### 3. 隔离问题
将有问题的公式单独放到一个测试文件中，验证是否能正确渲染
